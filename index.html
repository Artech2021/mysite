<!DOCTYPE html>
<html lang="zh">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3J58R70BFY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3J58R70BFY');
  </script>
<meta charset="UTF-8" />
<title>知识 → 问题</title>
<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #ffffff;
  color: #111;
  margin: 0;
  padding: 50px;
}
.container {
  max-width: 1000px;
  margin: auto;
}
h1 {
  font-size: 30px;
  font-weight: 800;
  margin-bottom: 50px;
}
textarea {
  width: 100%;
  height: 220px;
  padding: 14px;
  font-size: 14px;
  border: 1px solid #ddd;
  border-radius: 6px;
  resize: vertical;
}
button {
  margin-top: 16px;
  padding: 10px 18px;
  font-size: 14px;
  border-radius: 6px;
  border: none;
  background: #111;
  color: #fff;
  cursor: pointer;
}
button:hover {
  opacity: 0.9;
}
.section {
  margin-top: 40px;
}
.section h2 {
  font-size: 16px;
  border-bottom: 1px solid #eee;
  padding-bottom: 6px;
}
.question {
  margin: 14px 0;
  font-size: 14px;
}
.option {
  margin-left: 18px;
}
hr {
  border: none;
  border-top: 1px solid #eee;
  margin: 60px 0;
}
</style>
</head>

<body>
<div class="container">
  <h1>Knowledge to Shorthand notes<br><span style="font-size: 0.5em;">知识 → 问题</span></h1>

  <textarea id="inputText" placeholder="粘贴你的文章内容（支持几千字）"></textarea>
  <br>
  <button onclick="generate()">生成题目</button>

  <div id="output"></div>
</div>

<script>
function generate() {
  const text = document.getElementById("inputText").value.trim();
  if (!text) return;

  // 改进的文本分析
  const sentences = text
    .replace(/\n+/g, "")
    .split(/。|！|\?|？|!/)
    .filter(s => s.length > 15)
    .map(s => s.trim());

  // 识别关键句子（包含数字、专有名词、结论性词汇的句子更重要）
  const keySentences = sentences.filter(s => {
    return /[0-9]|关键|重要|核心|必须|应该|因此|所以|结论|表明|显示|证明/.test(s);
  });

  // 如果关键句子不足，使用普通句子补充
  const allSentences = keySentences.length > 0 ? [...keySentences, ...sentences] : sentences;
  // 去重
  const uniqueSentences = [...new Set(allSentences)];

  let output = "";

  /* 选择题 */
  output += `<div class="section"><h2>一、选择题</h2>`;
  uniqueSentences.slice(0, 5).forEach((s, i) => {
    // 提取关键信息作为问题核心
    const keyInfo = extractKeyInfo(s);
    const question = generateMultipleChoiceQuestion(s, keyInfo, i + 1);
    output += question;
  });
  output += `</div><hr>`;

  /* 判断题 */
  output += `<div class="section"><h2>二、判断题</h2>`;
  uniqueSentences.slice(5, 10).forEach((s, i) => {
    const question = generateTrueFalseQuestion(s, i + 1);
    output += question;
  });
  output += `</div><hr>`;

  /* 问答题 */
  output += `<div class="section"><h2>三、问答题</h2>`;
  uniqueSentences.slice(10, 15).forEach((s, i) => {
    const question = generateShortAnswerQuestion(s, i + 1);
    output += question;
  });
  output += `</div>`;

  document.getElementById("output").innerHTML = output;
}

// 提取关键信息
function extractKeyInfo(sentence) {
  // 查找包含关键信息的短语
  const keyPatterns = [
    /[0-9]+(年|月|日|天|小时|分钟|秒|次|个|件|人|元|米|千克)/,
    /[A-Za-z0-9_]+/,
    /[\u4e00-\u9fa5]{2,}(理论|方法|技术|原则|定律|定理|概念|模型|系统)/,
    /必须|应该|禁止|允许|可以|不可以/,
    /核心|关键|重要|主要|次要|首先|其次|最后/
  ];

  for (const pattern of keyPatterns) {
    const match = sentence.match(pattern);
    if (match) {
      return match[0];
    }
  }
  
  // 如果没有找到特定模式，返回句子前15个字符
  return sentence.slice(0, 15);
}

// 生成选择题
function generateMultipleChoiceQuestion(sentence, keyInfo, questionNum) {
  // 生成更有意义的干扰项
  const distractors = generateDistractors(sentence, keyInfo);
  const options = [keyInfo, ...distractors].sort(() => Math.random() - 0.5);
  const correctIndex = options.indexOf(keyInfo);
  const optionLabels = ['A', 'B', 'C', 'D'];

  let questionHtml = `
    <div class="question">
      ${questionNum}. 「${sentence}」中的关键概念是：
  `;

  options.forEach((option, j) => {
    questionHtml += `
        <div class="option">${optionLabels[j]}. ${option}</div>
    `;
  });

  questionHtml += `
      <div class="option" style="color: #666; font-size: 12px; margin-top: 8px;">正确答案：${optionLabels[correctIndex]}</div>
    </div>
  `;

  return questionHtml;
}

// 生成干扰项
function generateDistractors(sentence, keyInfo) {
  const distractors = [];
  
  // 干扰项1：相关但不同的概念
  const relatedConcepts = ["相关概念A", "相关概念B", "类似概念", "相近术语"];
  distractors.push(relatedConcepts[Math.floor(Math.random() * relatedConcepts.length)]);

  // 干扰项2：错误的关键信息
  let wrongInfo = keyInfo;
  if (/\d+/.test(wrongInfo)) {
    wrongInfo = wrongInfo.replace(/\d+/, (match) => {
      const num = parseInt(match);
      return num + Math.floor(Math.random() * 10) + 1;
    });
  } else if (wrongInfo.length > 2) {
    wrongInfo = wrongInfo.slice(0, -1) + (wrongInfo[wrongInfo.length - 1] === '的' ? '地' : '的');
  } else {
    wrongInfo += "错误";
  }
  distractors.push(wrongInfo);

  // 干扰项3：反义词或对立概念
  const antonyms = ["相反概念", "对立概念", "否定形式", "相反意义"];
  distractors.push(antonyms[Math.floor(Math.random() * antonyms.length)]);

  return distractors;
}

// 生成判断题
function generateTrueFalseQuestion(sentence, questionNum) {
  // 随机生成正确或错误的陈述
  const isTrue = Math.random() > 0.3; // 70%概率为真
  let statement = sentence;
  
  if (!isTrue) {
    // 生成错误陈述
    let modified = false;
    
    // 尝试多种方式修改句子
    if (statement.includes("是")) {
      statement = statement.replace("是", "不是");
      modified = true;
    } else if (statement.includes("有")) {
      statement = statement.replace("有", "没有");
      modified = true;
    } else if (statement.includes("可以")) {
      statement = statement.replace("可以", "不可以");
      modified = true;
    } else if (statement.includes("必须")) {
      statement = statement.replace("必须", "不必");
      modified = true;
    } else if (statement.match(/\d+/)) {
      statement = statement.replace(/\d+/, (match) => {
        const num = parseInt(match);
        return num + Math.floor(Math.random() * 10) + 1;
      });
      modified = true;
    } 
    
    // 如果无法修改，添加否定前缀
    if (!modified) {
      statement = "以下描述错误：" + statement;
    }
  }

  return `
    <div class="question">
      ${questionNum}. 「${statement}」是否正确？（√ / ×）
      <div style="color: #666; font-size: 12px; margin-top: 4px;">正确答案：${isTrue ? "√" : "×"}</div>
    </div>
  `;
}

// 生成问答题
function generateShortAnswerQuestion(sentence, questionNum) {
  const keyInfo = extractKeyInfo(sentence);
  let question = "";
  
  if (sentence.includes("为什么")) {
    question = "请解释为什么" + sentence.replace("为什么", "");
  } else if (sentence.includes("是什么")) {
    question = sentence;
  } else {
    question = `请简述「${keyInfo}」的相关内容`;
  }

  return `
    <div class="question">
      ${questionNum}. ${question}
    </div>
  `;
}
</script>
</body>
</html>
